#!/usr/bin/env bash
##########################################################################
# Script Name  : grevert
# Description  : Revert most recent commit to the previous version after it's been pushed to repo
# Dependencies : git
# Arguments    : none
# Author       : Copyright Â© 2024 Richard B. Romig, Mosfanet
# Email        : rick.romig@gmail.com | rick.romig@mymetronet.net
# Created      : 19 May 2024
# Last updated : 10 Oct 2024
# Comments     :
# TODO (Rick)  :
# License      : GNU General Public License, version 2.0
##########################################################################

## Shellcheck Directives ##
# shellcheck source=/home/rick/bin/functionlib

## Source function library ##

if [[ -x "$HOME/bin/functionlib" ]]; then
  source "$HOME/bin/functionlib"
else
  printf "\e[91mERROR:\e[0m functionlib not found!\n" >&2
  exit 1
fi

set -eu

git_revert() {
	local hash
	printf "Reverting the most recent pushed commit to the previous version.\n"
	hash=$(git log --oneline | head -n 1 | cut -d' ' -f1)
	git revert "$hash" --no-edit
	git log --oneline | head -n 2
	git push
}

main() {
	local script version
	script=$(basename "$0")
	version="2.0.24284"
	check_package git
[[ -d "$PWD/.git" ]] || die "You are not in the main directory of a git repositiory." 1
	git_revert
	leave "$script v$version"
}

main "$@"

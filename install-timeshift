#!/usr/bin/env bash
###############################################################################
# Script Name  : install-timeshift
# Description  : installs and configures timeshift
# Dependencies : none
# Arguments    : none
# Author       : Copyright Â© 2024, Richard B. Romig, Mosfanet
# Email        : rick.romig@gmail.com | rick.romig@mymetronet.com
# Created      : 03 Jun 2024
# Last updated : 12 Aug 2024
# Comments     : My default configuration is 5 daily, 3 weekly, & 2 monthly snapshots.
# TODO (Rick)  :
# License      : GNU General Public License, version 2.0
###############################################################################

## Shellcheck Directives ##
# shellcheck source=/home/rick/bin/functionlib

## Load function library ##

if [[ -x "$HOME/bin/functionlib" ]]; then
  source "$HOME/bin/functionlib"
else
  echo -e "\e[91mERROR:\e[0m functionlib not found!" >&2
  exit 1
fi

## Global variables ##
_script=$(basename "$0"); readonly _script
readonly _version="1.2.24225"

## Functions ##

configure_timeshift() {
  local ts_dir ts_json sed_dir sed_file
  ts_dir="/etc/timeshift"
  ts_json="timeshift.json"
  sed_dir="$HOME/bin/files"
  sed_file="timeshift.sed"
  [[ -f "$ts_dir/$ts_json" ]] || sudo cp -v "$ts_dir/default.json" "$ts_dir/$ts_json"
  sudo sed -i -f "$sed_dir/$sed_file" "$ts_dir/$ts_json"
  sudo sed -i 's/^"\//    "\//;s/^"/  "/' "$ts_dir/$ts_json"
}

## Execution ##

sudo_login 2
box "$_script v$_version"
echo "Installing Timeshift..."
sudo apt-get -y timeshift
echo "Configuring Timeshift..."
configure_timeshift
echo "$(timeshift --version) installed and configured."
exit

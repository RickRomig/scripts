#!/usr/bin/env bash
##########################################################################
# Script Name  : greset
# Description  : Reset most recent commit to the previous version before it's pushed to repo
# Dependencies : git
# Arguments    : none
# Author       : Copyright Â© 2024 Richard B. Romig, Mosfanet
# Email        : rick.romig@gmail.com | rick.romig@mymetronet.net
# Created      : 19 May 2024
# Last updated : 19 Mar 2025
# Comments     : Commits that haven't been pushed to the repository.
# TODO (Rick)  :
# License      : GNU General Public License, version 2.0
##########################################################################

## Shellcheck Directives ##
# shellcheck source=/home/rick/bin/functionlib

## Source function library ##

if [[ -x "$HOME/bin/functionlib" ]]; then
  source "$HOME/bin/functionlib"
else
  printf "\e[91mERROR:\e[0m functionlib not found!\n" >&2
  exit 1
fi

set -eu

## Functions ##

git_reset() {
	local hash
	hash=$(git log --oneline | head -n 1 | cut -d' ' -f1)
	printf "Resettng the most recent commit that has not been pushed to the remote repository to the previous version.\n"
	git reset "$hash"
	git log --oneline | head -n 2
}

main() {
	local script version
	script=$(basename "$0")
	version="2.1.25068"
	check_package git
	[[ -d "$PWD/.git" ]] || die "You are not in the main directory of a git repositiory." 1
	if y_or_n "Reset last commit (not pushed) to the previous version?"; then
		git_reset
	else
		printf "Last commit unchanged.\n"
	fi
	over_line "$script $version"
	exit
}

## Execution ##

main "$@"

#!/usr/bin/env bash
#####################################################################
# Script Name  : mk-changelog
# Description  : Create a changelog file from a template
# Dependencies : sed
# Arguments    : Project name
# Author       : Richard B. Romig, 09 April 2019
# Email        : rick.romig@gmail.com
# Comment      :
# TODO (rick)  :
# License      : GNU General Public License, version 2.0
###############################################################################

## Shellcheck Directives ##
# shellcheck source=/home/rick/bin/functionlib
# shellcheck disable=SC1091

## Load function library ##

if [[ -x "$HOME/bin/functionlib" ]]; then
  source "$HOME/bin/functionlib"
else
  echo -e "\e[91mERROR:\e[0m functionlib not found!" >&2
  exit 1
fi

# Variables

readonly _script=$(basename "$0")
readonly _version="0.1.4"
readonly _updated="08 Oct 2021"
readonly template_dir="$HOME/bin/Templates"

# Information to be inserted into changelog template

readonly today=$(date +"%d %B %Y")
readonly copy_holder="Richard B. Romig"
readonly email_addr="rick.romig@gmail.com"

# Functions

usage() {
  local errcode="${1:-2}"
  echo "${orange}Usage:${normal} $_script <project-name>"
  echo "${orange}Example:${normal} $_script my-project"
  exit "$errcode"
}

# Check arguments

if [[ -z "$1" ]]; then
  echo "${lightred}Error:${normal} No argment passed." >&2
  usage 2
elif [[ "$1" = "-h" || "$1" = "--help" ]]; then
  echo "$_script v$_version ($_updated)"
  usage 0
else
  project=$1
fi

# Introduction

echo "$_script v$_version ($_updated)"
echo "Creating a changelog.md template for project $project"

# Fill in placeholders and create changelog.md

sed -e '1d' \
    -e "s/<PROJECT>/$project/" \
    -e "s/<AUTHOR>/$copy_holder/" \
    -e "s/<EMAIL>/$email_addr/" \
    -e "s/<DATE>/$today/" "$template_dir/changelog" > changelog.md

echo "The changelog.md for $project has been created."
edit_view_quit changelog.md

exit
